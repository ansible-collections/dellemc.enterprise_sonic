---
- name: Test case - patch rollback
  sonic_image_management:
    patch:
      command: 'rollback'
      name: 'test.patch'
  register: result
  ignore_errors: true

- name: Update facts
  ansible.builtin.set_fact:
    result_msg: "{{ result.msg | from_yaml }}"
  when: result.msg is defined

- name: Assertion
  ansible.builtin.assert:
    that:
      - result.failed == true
      - result.msg is defined
      - result_msg['code'] == 400
      - result_msg['ietf-restconf:errors']['error'][0]['error-type'] == 'application'
      - result_msg['ietf-restconf:errors']['error'][0]['error-tag'] == 'invalid-value'
  register: assert_result
  ignore_errors: true

- name: Update facts
  ansible.builtin.include_tasks: image_management.test.facts.report.yml
  vars:
    test_case_name: 'patch_rollback'
    test_case_input:
      patch:
        command: 'rollback'
        path: 'test.patch'
