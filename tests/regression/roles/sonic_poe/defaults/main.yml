---
ansible_connection: httpapi
module_name: sonic_poe

preparation_tests:
  init_ethernet:
    - 'interface Ethernet1'
    - 'interface Ethernet2'
    - 'interface Ethernet3'
    - 'interface Ethernet4'

cleanup_tests: {}

tests:
  - name: test_case_01_platform_supported
    description: test merging all config
    state: merged
    input:
      interfaces:
        - name: Ethernet0
          detection: dot3bt
          priority: low
      global:
        power_mgmt_model: 'class'

  - name: test_case_02_all_cards_settings
    description: test merging all settings of additional cards
    state: merged
    input:
      cards:
        - card_id: 0
          usage_threshold: 50
          auto_reset: true
          power_mgmt_model: dynamic

  - name: test_case_03_all_interface_settings
    description: test merging all settings for interfaces
    state: merged
    input:
      interfaces:
        - name: Ethernet1
          enabled: true
          detection: legacy
          disconnect_type: dc
          four_pair: true
          high_power: true
          power_classification: normal
          power_limit: 3000
          power_limit_type: user-defined
          power_pairs: spare
          power_up_mode: dot3at
          priority: low
          use_spare_pair: true

  - name: test_case_04_all_global_settings
    description: test merging all global settings for poe
    state: merged
    input:
      global:
        auto_reset: true
        power_mgmt_model: 'class'
        usage_threshold: 49
  
  - name: test_case_05_delete_card
    description: test deleting one item from cards list
    state: deleted
    input:
      cards:
        - card_id: 0

  - name: test_case_06_delete_interface
    description: test deleting one item from interfaces list
    state: deleted
    input:
      interfaces:
        - name: Ethernet1

  - name: test_case_07_delete_global
    description: test deleting all settings from global poe settings
    state: deleted
    input:
      global:
        auto_reset: true
        power_mgmt_model: 'class'
        usage_threshold: 90
  
  - name: test_case_04_overridden_set
    description: test setting everything in overridden
    state: overridden
    input:
      cards:
        - card_id: 1
          usage_threshold: 39
          power_mgmt_model: dynamic
      interfaces:
        - name: Ethernet0
          enabled: true
          detection: dot3bt
        - name: Ethernet1
          enabled: true
          disconnect_type: ac
      global:
        auto_reset: false
        power_mgmt_model: 'static'
        usage_threshold: 98
  
  - name: test_case_05_deleted_clears
    description: test clearing lists in deleted
    state: deleted
    input:
      cards: []
      interfaces: []

  - name: test_case_06_replaced
    description: test can replace lists
    state: replaced
    input:
      cards:
        - card_id: 1
          usage_threshold: 40
      interfaces:
        - name: Ethernet1
          enabled: false
          power_limit: 240
      global:
        auto_reset: true

  - name: test_case_07_deleted_clear_everything
    description: test clearing everything
    state: deleted
    input: {}
  

    