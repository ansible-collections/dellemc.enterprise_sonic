- name: Deletes old radius server configurations
  sonic_radius_server:
    config: {}
    state: deleted
  ignore_errors: yes

- name: Install RADIUS CA cert
  vars:
    ansible_connection: network_cli
  dellemc.enterprise_sonic.sonic_config:
    commands: ['crypto trust-store radius-ts ca-cert cacert']
    save: yes
  failed_when: false

- name: Crypto security profile ca-cert configurations
  vars:
    ansible_connection: network_cli
  dellemc.enterprise_sonic.sonic_config:
    commands: ['crypto security-profile radius-sec-profile']
    save: yes
  failed_when: false

- name: Crypto security profile ca-cert configurations
  vars:
    ansible_connection: network_cli
  dellemc.enterprise_sonic.sonic_config:
    commands: ['crypto security-profile rad-sec-prof']
    save: yes
  failed_when: false

- name: Crypto security profile ca-cert configurations
  vars:
    ansible_connection: network_cli
  dellemc.enterprise_sonic.sonic_config:
    commands: ['crypto security-profile trust-store rad-sec-prof radius-ts']
    save: yes
  failed_when: false

- name: Crypto security profile ca-cert configurations
  vars:
    ansible_connection: network_cli
  dellemc.enterprise_sonic.sonic_config:
    commands: ['crypto security-profile trust-store radius-sec-profile radius-ts']
    save: yes
  failed_when: false

- name: Install RADIUS client certs
  vars:
    ansible_connection: network_cli
  dellemc.enterprise_sonic.sonic_command:
    commands: ['crypto cert install cert-file home://client.cert.pem key-file
home://client.key.pem']
  register: cmd_op
  failed_when: false

- name: Crypto security profile host certificate configurations
  vars:
    ansible_connection: network_cli
  dellemc.enterprise_sonic.sonic_config:
    commands: ['crypto security-profile certificate radius-sec-profile client.cert']
    save: yes
  failed_when: false

- name: Crypto security profile host certificate configurations
  vars:
    ansible_connection: network_cli
  dellemc.enterprise_sonic.sonic_config:
    commands: ['crypto security-profile certificate rad-sec-prof client.cert']
    save: yes
  failed_when: false

- name: Install RADIUS CA cert
  vars:
    ansible_connection: network_cli
  dellemc.enterprise_sonic.sonic_command:
    commands: 'crypto ca-cert install home://cacert.pem'
  register: cmd_op
  failed_when: false
