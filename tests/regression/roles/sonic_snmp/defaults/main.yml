---
ansible_connection: httpapi
module_name: sonic_snmp
vrf1: "Vrf1"
vrf2: "Vrf2"


tests_single_run:
  - name: test_case_01_merged_unencrypted_user
    description: Merge SNMP unencrypted user configuration
    state: merged
    input:
      user:
        - name: 'user1'
          auth:
            auth_type: 'sha'
            key: 'pwd1234567'
          priv:
            priv_type: 'aes'
            key: 'pwd1234567'
          encrypted: False
      location: 'Lab1, Rack-10'

tests:
  - name: test_case_01_merge
    description: Merge SNMP enable_trap, contact, encrypted user, and location configuration
    state: merged
    input:
      user:
        - name: 'user2'
          auth:
            auth_type: 'sha'
            key: 'U2FsdGVkX1+32ZWR59pAz9fBpX2cBt/Taphdov2f+jEzwPDQpWlBdzIS7j6GSKHSnryXROEkk6Z1pDvzpvae0g=='
          priv:
            priv_type: 'aes'
            key: 'U2FsdGVkX1/W3glwEVU3mQu/R5PPTnudp7hnhvrS1UyGFCmCcnDW3YEJZvw1xyFE1AN2L/r7TAwCUhvAP3XLcw=='
          encrypted: True
      location: 'Lab1, Rack-10'
      enable_trap:
        - 'auth-fail'
        - 'bgp'
        - 'config-change'
        - 'link-down'
        - 'link-up'
        - 'ospf'
      contact: 'Dell Support'
  
  - name: test_case_02_merge_engine
    description: Merge SNMP engine ID configuration
    state: merged
    input:
      engine: 23:45:67:89:ab

  - name: test_case_03_merge_user_and_enable_trap
    description: Merge SNMP user configuration with other key types and enable_trap with the 'all' trap type.
    state: merged
    input:
      user:
        - name: 'user3'
          auth:
            auth_type: 'sha2-256'
            key: 'U2FsdGVkX1/vqhOHul6YKTTxMfJb1785U8Hh5yDEETDfKsPEqai2uH8v6KX0nt1WRzLgSFLb1WhGzmy7NzsvTQ=='
          priv:
            priv_type: 'des'
            key: 'U2FsdGVkX19LUhXu+GHOeKOR3jDvIYhob/EgD6q7If+eCumbDCurRQUFsQHjDBQPYoq5llVBXCat+vwwx7y6PQ=='
          encrypted: True
        - name: 'user7'
          auth:
            auth_type: 'sha2-512'
            key: 'U2FsdGVkX1/vqhOHul6YKTTxMfJb1785U8Hh5yDEETDfKsPEqai2uH8v6KX0nt1WRzLgSFLb1WhGzmy7NzsvTQ=='
          priv:
            priv_type: 'des'
            key: 'U2FsdGVkX19LUhXu+GHOeKOR3jDvIYhob/EgD6q7If+eCumbDCurRQUFsQHjDBQPYoq5llVBXCat+vwwx7y6PQ=='
          encrypted: True
        - name: 'user8'
          auth:
            auth_type: 'sha2-384'
            key: 'U2FsdGVkX1/vqhOHul6YKTTxMfJb1785U8Hh5yDEETDfKsPEqai2uH8v6KX0nt1WRzLgSFLb1WhGzmy7NzsvTQ=='
          priv:
            priv_type: 'des'
            key: 'U2FsdGVkX19LUhXu+GHOeKOR3jDvIYhob/EgD6q7If+eCumbDCurRQUFsQHjDBQPYoq5llVBXCat+vwwx7y6PQ=='
          encrypted: True

  - name: test_case_04_delete_some_options
    description: Delete SNMP engine, location, contact and enable_trap configuration
    state: deleted
    input:
      engine: 23:45:67:89:ab
      location: 'Lab1, Rack-10'
      enable_trap:
        - 'auth-fail'
        - 'bgp'
        - 'config-change'
        - 'link-down'
        - 'link-up'
        - 'ospf'
      contact: 'Dell Support'

  - name: test_case_05_merge_existing_user
    description: Merge SNMP user configuration
    state: merged
    input:
      user:
        - name: 'user3'
          auth:
            auth_type: 'sha'
            key: 'U2FsdGVkX1/vqhOHul6YKTTxMfJb1785U8Hh5yDEETDfKsPEqai2uH8v6KX0nt1WRzLgSFLb1WhGzmy7NzsvTQ=='
          priv:
            priv_type: 'des'
            key: 'U2FsdGVkX19LUhXu+GHOeKOR3jDvIYhob/EgD6q7If+eCumbDCurRQUFsQHjDBQPYoq5llVBXCat+vwwx7y6PQ=='
          encrypted: True
      enable_trap:
        - 'all'


  - name: test_case_06_merged_group_community_view
    description: Merge group access, community, and view SNMP configuration
    state: merged
    input:
      group:
        - name: 'group-lab'
          access:
            - security_model: 'v2c'
              security_level: 'auth-priv'
              read_view: 'r_view'
              write_view: 'w_view'
              notify_view: 'n_view'
        - name: 'group1'
          access:
            - security_model: 'usm'
              security_level: 'no-auth-no-priv'
              read_view: 'r_view'
              write_view: 'w_view'
              notify_view: 'n_view'
        - name: 'group2'
          access:
            - security_model: 'any'
              security_level: 'auth-no-priv'
              read_view: 'r_view'
              write_view: 'w_view'
              notify_view: 'n_view'
      community:
        - group: 'group-lab'
          name: 'comm1'
      view:
        - name: 'view2'
          excluded:
            - '1.2.3.4.5.6.7.8.9.2'

  - name: test_case_07_merge_multiple_host_and_agentaddress
    description: Merge multiple SNMP hosts and agentaddresses
    state: merged
    input:
      host:
        - ip: '1.2.3.5'
          timeout: 300
          tag: 'inform'
          retries: 20
          vrf: '{{ vrf1 }}'
        - ip: '1.2.3.4'
          timeout: 800
          retries: 30
          tag: 'inform'
          vrf: '{{ vrf1 }}'
      agentaddress:
        - ip: '1.2.3.5'
          port: 1024
          interface: 'Eth1/30'
        - ip: '1.2.3.6'
          port: 1030
          interface: 'Eth1/30'

  - name: test_case_08_delete_agentaddress
    description: Delete SNMP agentaddress
    state: deleted
    input:
      agentaddress:
        - ip: '1.2.3.5'
          port: 1024
          interface: 'Eth1/30'

  - name: test_case_09_merge_multiple_user_one_group
    description: Merge multiple SNMP users and groups
    state: merged
    input:
      user:
        - name: 'user8'
          group: 'group-lab'
        - name: 'user9'
          group: 'group-lab'
      community:
        - group: 'group-lab'
          name: 'comm3'
        - group: 'group-lab'
          name: 'comm4'

  - name: test_case_10_delete_community
    description: Delete SNMP community
    state: deleted
    input:
      community:
          - name: 'comm4'

  - name: test_case_11_replaced_group
    description: Replace some of a SNMP group
    state: replaced
    input:
      group:
        - name: 'group-lab'
          access:
            - security_model: 'v2c'
              security_level: 'auth-no-priv'
              read_view: 'r_view'
              write_view: 'w_view'
              notify_view: 'n_view'

  - name: test_case_12_replaced_host
    description: Replace SNMP host
    state: replaced
    input:
      host:
        - ip: '1.2.3.5'
          timeout: 500
          tag: 'inform'
          retries: 50
          port: 162
          vrf: '{{ vrf1 }}'

  - name: test_case_13_overridden_host
    description: Override host and group
    state: overridden
    input:
      host:
        - ip: '1.2.3.6'
          timeout: 500
          tag: 'inform'
          retries: 40
          port: 162

  - name: test_case_14_merge_group
    description: Merge some of a SNMP group
    state: merged
    input:
      group:
        - name: 'group-lab'
          access:
            - security_model: 'v2c'
              security_level: 'auth-no-priv'
              read_view: 'r_view'
              write_view: 'w_view'
              notify_view: 'n_view'

  - name: test_case_15_delete_group
    description: Delete all SNMP server configuration for the "group" sub-option
    state: deleted
    input:
      group:
        - name: 'group-lab'

  - name: test_case_16_merge_community_and_view
    description: Merge some of the SNMP configuration
    state: merged
    input:
      group:
        - name: 'group-lab'
      community:
        - group: 'group-lab'
          name: 'comm1'
      view:
        - name: 'view2'
          excluded:
            - '1.2.3.4.5.6.7.8.9.2'

  - name: test_case_17_deleted_all
    description: Delete all SNMP server configuration
    state: deleted
    input: {}